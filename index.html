<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willy & Nengsy Wedding</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --sage-green-light: #C4D7B2;
            --sage-green-medium: #A4B494;
            --sage-green-dark: #7A8D6E;
        }
        body {
            font-family: 'Inter', sans-serif;
            color: #4B5563; /* Gray-600 */
            background-color: #F9FAF8;
            overflow-x: hidden;
        }
        .hero-section {
            background-image: url('https://lh3.googleusercontent.com/d/1br670JCVHrg5mmI6rNftIms0PMYycLAo');
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Parallax effect */
            background-repeat: no-repeat;
            position: relative;
        }
        .hero-overlay {
            background: rgba(0, 0, 0, 0.4);
        }
        .cursive {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 300;
        }
        .button-primary {
            background-color: var(--sage-green-medium);
            transition: all 0.3s ease;
        }
        .button-primary:hover {
            background-color: var(--sage-green-dark);
            transform: scale(1.05);
        }
        .section-header {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
        }
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .fade-in.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .gallery img {
            transition: transform 0.3s ease;
        }
        .gallery img:hover {
            transform: scale(1.05);
        }
        .gift-container {
            position: relative;
        }
        .copied-message {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--sage-green-dark);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .copied-message.show {
            opacity: 1;
        }
    </style>
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // Firebase configuration and initialization
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        setLogLevel('Debug');

        let app;
        let db;
        let auth;
        let userId;

        const firebaseConfig = {
  apiKey: "AIzaSyAcfRdmWUazP2ORjHng5NI6ZAzbdGR8gis",
  authDomain: "web-undangan-8649e.firebaseapp.com",
  projectId: "web-undangan-8649e",
  storageBucket: "web-undangan-8649e.firebasestorage.app",
  messagingSenderId: "205742697194",
  appId: "1:205742697194:web:cde18463a7132d4f6d4593",
  measurementId: "G-GB7M31ETDZ"
};
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            if (initialAuthToken) {
                try {
                    await signInWithCustomToken(auth, initialAuthToken);
                } catch (error) {
                    console.error("Error signing in with custom token:", error);
                    await signInAnonymously(auth);
                }
            } else {
                await signInAnonymously(auth);
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    console.log("User signed in with UID:", userId);
                    setupFirestoreListeners();
                } else {
                    console.log("User signed out or an error occurred.");
                    // In this case, use a unique ID for private data
                    userId = 'anonymous-' + Math.random().toString(36).substr(2, 9);
                    setupFirestoreListeners();
                }
            });
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const collectionPublicPath = `/artifacts/${appId}/public/data/greetings`;
        const collectionPrivatePath = `/artifacts/${appId}/users/${userId}/rsvps`;

        // Wait for the DOM to be ready before initializing Firebase
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
        });
        
        // --- RSVP Handling ---
        const rsvpForm = document.getElementById('rsvp-form');
        rsvpForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('rsvp-name').value;
            const attendance = document.getElementById('rsvp-attendance').value;
            const rsvpStatus = document.getElementById('rsvp-status');
            
            if (!name || !attendance) {
                rsvpStatus.textContent = 'Nama dan kehadiran wajib diisi.';
                return;
            }

            try {
                // Check if user has already RSVP'd
                const q = query(collection(db, collectionPrivatePath), where("name", "==", name));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    // Update existing RSVP
                    const rsvpDocRef = querySnapshot.docs[0].ref;
                    await updateDoc(rsvpDocRef, {
                        attendance: attendance,
                        timestamp: serverTimestamp()
                    });
                    rsvpStatus.textContent = 'RSVP berhasil diperbarui!';
                } else {
                    // Add new RSVP
                    await addDoc(collection(db, collectionPrivatePath), {
                        name: name,
                        attendance: attendance,
                        timestamp: serverTimestamp()
                    });
                    rsvpStatus.textContent = 'RSVP berhasil dikirimkan!';
                }

                rsvpForm.reset();
            } catch (error) {
                console.error("Error submitting RSVP:", error);
                rsvpStatus.textContent = 'Terjadi kesalahan saat mengirim RSVP.';
            }
        });

        // --- Guestbook Handling ---
        const guestbookForm = document.getElementById('guestbook-form');
        const guestbookList = document.getElementById('guestbook-list');

        const setupFirestoreListeners = () => {
            if (!db) return; // Wait for Firebase to be initialized
            const q = query(collection(db, collectionPublicPath), limit(50));
            onSnapshot(q, (snapshot) => {
                const messages = [];
                snapshot.forEach((doc) => {
                    messages.push(doc.data());
                });

                // Sort messages by timestamp in descending order in JavaScript
                messages.sort((a, b) => b.timestamp - a.timestamp);

                guestbookList.innerHTML = '';
                messages.forEach((data) => {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'bg-gray-100 p-4 rounded-xl shadow-inner mb-4 fade-in';
                    messageElement.innerHTML = `
                        <p class="font-semibold text-gray-800">${data.name}</p>
                        <p class="text-gray-600 mt-1">${data.message}</p>
                    `;
                    guestbookList.appendChild(messageElement);
                });
            });
        };

        guestbookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('guestbook-name').value;
            const message = document.getElementById('guestbook-message').value;
            const guestbookStatus = document.getElementById('guestbook-status');

            if (!name || !message) {
                guestbookStatus.textContent = 'Nama dan ucapan wajib diisi.';
                return;
            }

            try {
                await addDoc(collection(db, collectionPublicPath), {
                    name: name,
                    message: message,
                    timestamp: serverTimestamp()
                });
                guestbookStatus.textContent = 'Ucapan berhasil dikirimkan!';
                guestbookForm.reset();
            } catch (error) {
                console.error("Error submitting guestbook message:", error);
                guestbookStatus.textContent = 'Terjadi kesalahan saat mengirim ucapan.';
            }
        });

        // Add to calendar functionality
        document.getElementById('add-to-calendar').addEventListener('click', () => {
            const date = new Date('2025-09-28T18:59:00');
            const eventDetails = {
                title: 'Resepsi Pernikahan Willy & Nengsy',
                description: 'Resepsi Pernikahan Willy & Nengsy',
                location: 'Ballroom Gereja Katolik St. Silvester Pecatu',
                startDate: date,
                endDate: date,
            };

            const googleCalendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventDetails.title)}&dates=${date.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '')}/${date.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '')}&details=${encodeURIComponent(eventDetails.description)}&location=${encodeURIComponent(eventDetails.location)}`;
            window.open(googleCalendarUrl, '_blank');
        });

    </script>
</head>
<body class="bg-gray-50 text-gray-700">
    <!-- Background Music -->
    <audio id="background-music" loop autoplay>
        <!-- NOTE: YouTube URLs cannot be used as a direct audio source. Please replace this with a direct link to an audio file (e.g., .mp3). -->
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-beautiful-wedding-march-371.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Parallax Hero Section -->
    <header id="hero" class="hero-section h-screen flex flex-col justify-center items-center text-white text-center">
        <div class="hero-overlay w-full h-full absolute top-0 left-0"></div>
        <div class="relative z-10 p-6 md:p-12 backdrop-blur-sm rounded-xl bg-black bg-opacity-10">
            <h4 class="text-xl md:text-2xl cursive animate-pulse">Undangan Pernikahan</h4>
            <h1 class="text-6xl md:text-8xl cursive mt-4">Willy & Nengsy</h1>
            <p class="text-lg md:text-xl font-light mt-4">Akan segera bersatu dalam pernikahan</p>
            <div id="countdown" class="mt-8 text-2xl md:text-4xl font-semibold"></div>
        </div>
    </header>

    <!-- Details Section -->
    <section id="details" class="py-16 md:py-24 bg-white">
        <div class="container mx-auto px-4 text-center">
            <h2 class="section-header text-4xl md:text-5xl mb-8 fade-in">Detail Acara</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-4xl mx-auto">
                <!-- Pemberkatan Nikah -->
                <div class="bg-gray-50 p-6 md:p-8 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-105 fade-in">
                    <h3 class="font-semibold text-2xl mb-2 section-header text-gray-800">Pemberkatan Nikah</h3>
                    <p class="mt-4 text-lg">Gereja Katolik Santo Silvester Pecatu Dreamland</p>
                    <p class="text-sm font-light">2025-09-28 | 15:00 WITA</p>
                    <a href="https://maps.app.goo.gl/eK4XVSXh9DEuEab27" target="_blank" class="mt-4 inline-block button-primary text-white font-semibold py-2 px-6 rounded-full shadow-lg">Lihat di Google Maps</a>
                </div>
                <!-- Resepsi -->
                <div class="bg-gray-50 p-6 md:p-8 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-105 fade-in">
                    <h3 class="font-semibold text-2xl mb-2 section-header text-gray-800">Resepsi</h3>
                    <p class="mt-4 text-lg">Ballroom Gereja Katolik St. Silvester Pecatu</p>
                    <p class="text-sm font-light">2025-09-28 | 18:59 WITA</p>
                    <a href="https://maps.app.goo.gl/eK4XVSXh9DEuEab27" target="_blank" class="mt-4 inline-block button-primary text-white font-semibold py-2 px-6 rounded-full shadow-lg">Lihat di Google Maps</a>
                </div>
            </div>
            <button id="add-to-calendar" class="mt-12 button-primary text-white font-semibold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                Tambahkan ke Kalender
            </button>
        </div>
    </section>

    <!-- Google Maps Section -->
    <section id="map" class="py-16 bg-gray-100">
        <div class="container mx-auto px-4 text-center">
            <h2 class="section-header text-4xl md:text-5xl mb-8 fade-in">Lokasi Acara</h2>
            <div class="max-w-4xl mx-auto rounded-3xl overflow-hidden shadow-2xl fade-in">
                <!-- Google Maps iframe -->
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3942.3456889759494!2d115.1187428751532!3d-8.790906291673898!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd244199c08006d%3A0x6734c56e29731690!2sSt.%20Silvester%20Pecatu%20Catholic%20Church!5e0!3m2!1sen!2sid!4v1718012028606!5m2!1sen!2sid" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="py-16 md:py-24 bg-white">
        <div class="container mx-auto px-4 text-center">
            <h2 class="section-header text-4xl md:text-5xl mb-8 fade-in">Galeri Foto</h2>
            <div class="gallery grid grid-cols-2 md:grid-cols-3 gap-6 fade-in">
                <img src="https://lh3.googleusercontent.com/d/1cG-a2-FsXm1hlc6HZw1CdAGql6wEwPnX" alt="Pasangan Willy dan Nengsy" class="w-full h-auto object-cover rounded-xl shadow-lg">
                <img src="https://lh3.googleusercontent.com/d/17AwS8Sl3_GN3utdF8GfhVRjSS1_yoC1Q" alt="Pasangan Willy dan Nengsy" class="w-full h-auto object-cover rounded-xl shadow-lg">
                <img src="https://lh3.googleusercontent.com/d/1a894EiZ0B7zk4l9j4TUPEXWPTvczGwZJ" alt="Pasangan Willy dan Nengsy" class="w-full h-auto object-cover rounded-xl shadow-lg">
                <img src="https://lh3.googleusercontent.com/d/1br670JCVHrg5mmI6rNftIms0PMYycLAo" alt="Pasangan Willy dan Nengsy" class="w-full h-auto object-cover rounded-xl shadow-lg">
                <img src="https://lh3.googleusercontent.com/d/1maD9JjTHm1D8UfWAi4DdgZiBukmmgtUh" alt="Pasangan Willy dan Nengsy" class="w-full h-auto object-cover rounded-xl shadow-lg">
                <img src="https://lh3.googleusercontent.com/d/1aggzAkW3d1a0WFikmbiBnlHBDZUWC_FE" alt="Pasangan Willy dan Nengsy" class="w-full h-auto object-cover rounded-xl shadow-lg">
            </div>
        </div>
    </section>

    <!-- RSVP Section -->
    <section id="rsvp" class="py-16 md:py-24 bg-gray-100">
        <div class="container mx-auto px-4 max-w-xl">
            <h2 class="section-header text-4xl md:text-5xl text-center mb-8 fade-in">Konfirmasi Kehadiran</h2>
            <form id="rsvp-form" class="bg-white p-8 rounded-2xl shadow-xl space-y-4 fade-in">
                <div>
                    <label for="rsvp-name" class="block text-gray-600">Nama Lengkap</label>
                    <input type="text" id="rsvp-name" name="name" class="w-full mt-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--sage-green-medium)]" required>
                </div>
                <div>
                    <label for="rsvp-attendance" class="block text-gray-600">Konfirmasi Kehadiran</label>
                    <select id="rsvp-attendance" name="attendance" class="w-full mt-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--sage-green-medium)]" required>
                        <option value="">Pilih</option>
                        <option value="hadir">Hadir</option>
                        <option value="tidak-hadir">Tidak Hadir</option>
                    </select>
                </div>
                <button type="submit" class="w-full button-primary text-white font-semibold py-3 rounded-full shadow-md transition-all duration-300 transform hover:scale-105">Kirim RSVP</button>
                <div id="rsvp-status" class="text-center mt-4 font-medium text-gray-600"></div>
            </form>
        </div>
    </section>

    <!-- Wedding Gift Section -->
    <section id="gift" class="py-16 bg-white">
        <div class="container mx-auto px-4 max-w-xl text-center">
            <h2 class="section-header text-4xl md:text-5xl mb-8 fade-in">Hadiah Pernikahan</h2>
            <div class="bg-gray-100 p-8 rounded-2xl shadow-xl fade-in">
                <p class="mb-4">Jika Anda ingin memberikan hadiah, Anda bisa mengirimkannya ke rekening di bawah ini:</p>
                <div class="bg-white p-6 rounded-xl border border-dashed border-[var(--sage-green-medium)] flex flex-col items-center">
                    <p class="font-semibold text-lg">BCA</p>
                    <p id="account-number" class="text-2xl font-bold mt-2 text-gray-800">772 1079086</p>
                    <button id="copy-button" class="mt-4 button-primary text-white py-2 px-6 rounded-full shadow-md transition-all duration-300 transform hover:scale-105 relative gift-container">
                        Salin Nomor Rekening
                        <span class="copied-message">Disalin!</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Guestbook Section -->
    <section id="guestbook" class="py-16 md:py-24 bg-gray-100">
        <div class="container mx-auto px-4 max-w-xl">
            <h2 class="section-header text-4xl md:text-5xl text-center mb-8 fade-in">Tinggalkan Ucapan</h2>
            <p class="text-center mb-8 text-lg fade-in">Kepada Bapak/Ibu/Saudara/i yang ingin memberikan ucapan kepada kami dapat dituliskan di bawah ini</p>
            
            <!-- Guestbook Form -->
            <form id="guestbook-form" class="bg-white p-8 rounded-2xl shadow-xl space-y-4 mb-12 fade-in">
                <div>
                    <label for="guestbook-name" class="block text-gray-600">Nama Lengkap</label>
                    <input type="text" id="guestbook-name" name="name" class="w-full mt-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--sage-green-medium)]" required>
                </div>
                <div>
                    <label for="guestbook-message" class="block text-gray-600">Ucapan & Doa</label>
                    <textarea id="guestbook-message" name="message" rows="4" class="w-full mt-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--sage-green-medium)]" required></textarea>
                </div>
                <button type="submit" class="w-full button-primary text-white font-semibold py-3 rounded-full shadow-md transition-all duration-300 transform hover:scale-105">Kirim Ucapan</button>
                <div id="guestbook-status" class="text-center mt-4 font-medium text-gray-600"></div>
            </form>

            <!-- Guestbook List -->
            <div id="guestbook-list" class="space-y-4 fade-in">
                <!-- Messages will be loaded here from Firestore -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-8 text-center text-gray-500 bg-white border-t border-gray-200">
        <p>Dengan cinta, Willy & Nengsy</p>
        <p class="text-sm mt-2">© 2024. All rights reserved.</p>
    </footer>

    <script>
        // Smooth scroll for navigation (optional but good practice)
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
        
        // Fading and animation on scroll
        const faders = document.querySelectorAll('.fade-in');
        const appearOptions = {
            threshold: 0.3
        };
        const appearOnScroll = new IntersectionObserver(function(entries, appearOnScroll) {
            entries.forEach(entry => {
                if (!entry.isIntersecting) {
                    return;
                } else {
                    entry.target.classList.add('is-visible');
                    appearOnScroll.unobserve(entry.target);
                }
            });
        }, appearOptions);

        faders.forEach(fader => {
            appearOnScroll.observe(fader);
        });

        // Countdown Timer
        const countdownDate = new Date("2025-09-28T18:59:00").getTime();
        const countdownEl = document.getElementById('countdown');

        const updateCountdown = () => {
            const now = new Date().getTime();
            const distance = countdownDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownEl.innerHTML = `${days} Hari : ${hours} Jam : ${minutes} Menit : ${seconds} Detik`;

            if (distance < 0) {
                clearInterval(interval);
                countdownEl.innerHTML = "Kami Telah Bersatu!";
            }
        }

        const interval = setInterval(updateCountdown, 1000);

        // Copy to clipboard
        const copyButton = document.getElementById('copy-button');
        copyButton.addEventListener('click', () => {
            const accountNumber = document.getElementById('account-number').textContent;
            
            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = accountNumber;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                const message = document.querySelector('.copied-message');
                message.classList.add('show');
                setTimeout(() => message.classList.remove('show'), 2000);
            } catch (err) {
                console.error('Failed to copy text', err);
            }
            document.body.removeChild(textArea);
        });

        // Background music play/pause control
        document.body.addEventListener('click', () => {
            const music = document.getElementById('background-music');
            if (music.paused) {
                music.play().catch(e => console.error("Auto-play was prevented."));
            }
        }, { once: true });

        // Ensure firebase initialization is run
        window.onload = function() {
            updateCountdown();
        }

    </script>
</body>
</html>
